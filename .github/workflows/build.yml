on: push

jobs:
    build-apk:
      name: buildSignedAPK
      runs-on: ubuntu-latest
      environment: APK_BUILD
      env:
        RELEASE_KEYSTORE: ${{ secrets.RELEASE_KEYSTORE }}
        RELEASE_KEYSTORE_PASSPHRASE: ${{ secrets.RELEASE_KEYSTORE_PASSPHRASE }}
        RELEASE_KEY_ALIAS: ${{ secrets.RELEASE_KEY_ALIAS }}<<
        RELEASE_KEY_PASSWORD: ${{ secrets.RELEASE_KEY_PASSWORD }}
        RELEASE_STORE_PASSWORD: ${{ secrets.RELEASE_STORE_PASSWORD }}

      steps:
        - name: Checkout project sources
          uses: actions/checkout@v3

        - name: Setup Gradle
          uses: gradle/gradle-build-action@v2

        - name: Setup Java
          uses: actions/setup-java@v3
          with:
            distribution: "oracle"
            java-version: "17"


        - name: Keystore
          run: |
            mkdir ./keystore
            echo "$RELEASE_KEYSTORE" > ./keystore/key.jks.asc
            gpg -d --passphrase "$RELEASE_KEYSTORE_PASSPHRASE" --batch ./keystore/key.jks.asc > ./keystore/key.jks
            ls keystore/
            readlink -f ./keystore

        - name: Build apk
          run : |
            python3 build.py
            ls dist/
